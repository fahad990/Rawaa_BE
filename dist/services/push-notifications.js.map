{"version":3,"sources":["../../src/services/push-notifications.js"],"names":["userId","title","body","console","log","findById","user","tokens","pushTokens","payload","notification","icon","length","admin","messaging","sendToDevice","then","response","catch","error","send","serviceAccount","require","initializeApp","credential","cert","databaseURL"],"mappings":";;;;;;;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;uEAEO,iBAAoBA,MAApB,EAA4BC,KAA5B,EAAmCC,IAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AACHC,gCAAQC,GAAR,CAAYJ,MAAZ;AADG;AAAA,+BAEc,eAAKK,QAAL,CAAcL,MAAd,CAFd;;AAAA;AAECM,4BAFD;AAGCC,8BAHD,GAGUD,KAAKE,UAHf;AAKGC,+BALH,GAKa;AACZC,0CAAc;AACVT,4CADU,EACHC,UADG;AAEVS,sCAAM;AAFI;AAId;AACA;AACA;AAPY,yBALb;;;AAgBH,4BAAIJ,OAAOK,MAAX,EAAmB;AACfC,kCAAMC,SAAN,GAAkBC,YAAlB,CAA+BR,MAA/B,EAAuCE,OAAvC,EACKO,IADL,CACU,oBAAY;AACdb,wCAAQC,GAAR,CAAY,4BAAZ,EAA0Ca,QAA1C;AACH,6BAHL,EAIKC,KAJL,CAIW,iBAAS;AACZf,wCAAQC,GAAR,CAAY,wBAAZ,EAAsCe,KAAtC;AACH,6BANL;AAOH;;AAxBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAeC,I;;;;;AA7BtB;;IAAYP,K;;AACZ;;;;;;;;;;AAEA,IAAMQ,iBAAiBC,QAAQ,yBAAR,CAAvB;;AAEAT,MAAMU,aAAN,CAAoB;AAChBC,gBAAYX,MAAMW,UAAN,CAAiBC,IAAjB,CAAsBJ,cAAtB,CADI;AAEhBK,iBAAa;AAFG,CAApB","file":"push-notifications.js","sourcesContent":["import * as admin from 'firebase-admin';\r\nimport User from \"../models/user.model\";\r\n\r\nconst serviceAccount = require(\"../service-account.json\");\r\n\r\nadmin.initializeApp({\r\n    credential: admin.credential.cert(serviceAccount),\r\n    databaseURL: \"https://rawaaprovider.firebaseio.com\"\r\n});\r\n\r\n//push manual notification\r\n// admin.messaging().sendToDevice(['06WxbUmLV8:APA91bHe16K975o1RxFZjxxPOxl0y96fnnQYBqbkXWF1JvC3qSUbZdPfTAU2XEfiP3OLHptgfc82k0F9TORnwT2UKXGYy88EPoMKvnolSTUkwT2lwTIFS3jTmUaW1CCw7aXps2fzpMFK'],\r\n//     {\r\n//         notification: {\r\n//             title: \"dsdsd\",\r\n//             body: \"hello form bakry\",\r\n//             icon:\"https://image.flaticon.com/icons/png/128/148/148921.png\"\r\n//         },\r\n//         data: {\r\n//             subject: \"bla b\",\r\n\r\n//         }\r\n//     }).then(response => {\r\n//         console.log(\"Successfully sent message:\", response.results[0]);\r\n//     })\r\n//     .catch(error => {\r\n//         console.log(\"Error sending message:\", error);\r\n//     });\r\n\r\nexport async function send(userId, title, body) {\r\n    console.log(userId)\r\n    let user = await User.findById(userId);\r\n    let tokens = user.pushTokens;\r\n\r\n    const payload = {\r\n        notification: {\r\n            title, body,\r\n            icon: \"https://image.flaticon.com/icons/png/128/148/148921.png\"\r\n        },\r\n        // data: {\r\n        //     subject\r\n        // }\r\n    }\r\n\r\n\r\n    if (tokens.length) {\r\n        admin.messaging().sendToDevice(tokens, payload)\r\n            .then(response => {\r\n                console.log(\"Successfully sent message:\", response);\r\n            })\r\n            .catch(error => {\r\n                console.log(\"Error sending message:\", error);\r\n            });\r\n    }\r\n\r\n}"]}