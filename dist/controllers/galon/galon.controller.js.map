{"version":3,"sources":["../../../src/controllers/galon/galon.controller.js"],"names":["validateBody","isUpdate","exists","withMessage","createGalon","req","res","next","validationErrors","array","length","user","type","file","body","img","_id","create","newDoc","status","json","allGalons","limit","parseInt","query","page","available","count","docsCount","find","populate","skip","sort","creationDate","allDocs","send","Math","ceil","galonDetails","galonId","params","findById","doc","updateGalon","galon","id","update","$set","size","priceOfBuying","priceOfSubstitution","minimumNumberOnOrder","newGalon","galonsOfOneProvider","userId","updateAvalaibiltyOfGalons","end","save"],"mappings":"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","file":"galon.controller.js","sourcesContent":["import Galon from '../../models/galon.model';\nimport mongoose from 'mongoose';\nimport { body, validationResult } from 'express-validator/check';\nimport { toImgUrl } from '../../utils/index'\nimport ApiError from '../../helpers/ApiError'\nimport ApiResponse from '../../helpers/ApiResponse'\n\n\nexport default {\n\n    validateBody(isUpdate = false) {\n        return [\n            body(\"size\").exists().withMessage(\"numberOfBottles is required\"),\n            body(\"priceOfBuying\").exists().withMessage(\"priceOfBuying is required\")\n        ];\n    },\n    //create new galon\n    async createGalon(req, res, next) {\n        const validationErrors = validationResult(req).array();\n        if (validationErrors.length > 0)\n            return next(new ApiError(422, validationErrors));\n        try {\n            if (!(req.user.type == \"PROVIDER\")) {\n                next(new ApiError(403, 'not provider user'))\n            }\n            if (req.file) {\n                req.body.img = await toImgUrl(req.file)\n            } else {\n                next(new ApiError(422, 'img is required'))\n            }\n            req.body.user = req.user._id\n            let newDoc = await Galon.create(req.body);\n            return res.status(201).json(newDoc);\n        } catch (err) {\n            next(err)\n        }\n    },\n\n    //retrive all galons \n    async allGalons(req, res, next) {\n        const limit = parseInt(req.query.limit) || 200;\n        const page = req.query.page || 1;\n        let query = {}\n        try {\n            if (req.query.available)\n                query.available = req.query.available\n            let docsCount = await Galon.count(query)\n            let allDocs = await Galon.find(query).populate('user')\n                .skip((page * limit) - limit).limit(limit).sort({ creationDate: -1 });\n            return res.send(new ApiResponse(\n                allDocs,\n                page,\n                Math.ceil(docsCount / limit),\n                limit,\n                docsCount,\n                req\n            ))\n        } catch (err) {\n            next(err)\n        }\n    },\n\n    //retrive one galone details \n    async galonDetails(req, res, next) {\n        const galonId = req.params.galonId;\n        let doc = await Galon.findById(galonId);\n        if (!doc)\n            return next(new ApiError(404));\n        return res.status(200).json(doc);\n    },\n\n    //update one galon details \n    async updateGalon(req, res, next) {\n        const galonId = req.params.galonId;\n        try {\n            let galon = await Galon.findById(galonId)\n            if (!(req.user.id == galon.user)) {\n                return next(new ApiError(403, \"not have access to this resourse\"))\n            }\n            if (req.file) {\n                req.body.img = await toImgUrl(req.file)\n            }\n            await Galon.update({ _id: galonId }, {\n                $set: {\n                    size: req.body.size || galon.size,\n                    img: req.body.img || galon.img,\n                    available: req.body.available || galon.available,\n                    priceOfBuying: req.body.priceOfBuying || galon.priceOfBuying,\n                    priceOfSubstitution: req.body.priceOfSubstitution || galon.priceOfSubstitution,\n                    minimumNumberOnOrder: req.body.minimumNumberOnOrder || galon.minimumNumberOnOrder,\n                }\n            })\n            let newGalon = await Galon.findById(galonId)\n                .populate('user')\n            return res.status(200).json(newGalon)\n        } catch (err) {\n            next(err)\n        }\n    },\n\n    //retrive all galons under one provider \n    async galonsOfOneProvider(req, res, next) {\n        const limit = parseInt(req.query.limit) || 200;\n        const page = req.query.page || 1;\n        const userId = req.params.userId;\n        try {\n            let query = {}\n            if (req.query.available)\n                query.available = req.query.available\n            query.user = userId\n            let docsCount = await Galon.count(query)\n            let allDocs = await Galon.find(query)\n                .populate('user')\n                .skip((page - 1) * limit).limit(limit).sort({ creationDate: -1 })\n            return res.send(new ApiResponse(\n                allDocs,\n                page,\n                Math.ceil(docsCount / limit),\n                limit,\n                docsCount,\n                req\n            ))\n        } catch (err) {\n            next(err)\n        }\n    },\n    //make carttons available\n    async updateAvalaibiltyOfGalons(req, res, next) {\n        try {\n            let galonId = req.params.galonId;\n            let galonDetails = await Galon.findById(galonId);\n            if (!galonDetails)\n                return res.status(404).end();\n\n            if (galonDetails.available == true)\n                galonDetails.available = false\n            else\n                galonDetails.available = true\n\n            await galonDetails.save();\n            return res.status(204).end();\n        } catch (err) {\n            next(err)\n        }\n    },\n\n\n}"]}