{"version":3,"sources":["../../src/controllers/admin.controller.js"],"names":["allUsers","req","res","next","user","type","query","find","sort","creationDate","users","status","json","createPriceOfKilloMeter","body","price","prices","length","create","newDoc","updatePriceOfKilloMeter","findByIdAndUpdate","params","id","new","retrivePriceOfOneKm","findOne","pric","deactiveUser","userId","findById","userDetails","active","newUser","activeUser","adminStatisttics","count","numberOfOrder","penddingOrder","acceptedOrder","rejectedOrder","onTheWayOrder","deliveredOrder","numberOfClient","numberOfProvider","getRecentOrders","limit","populate","allOrders","result","map","OneOrderItem","cartonsResult","cartons","elme","cartonsQuantity","x","oneCartonItem","item","quantity","push","galonsResult","galons","galonsQuantityOfBuying","galonsQuantityOfSubstitution","oneGalonsItem","QuantityOfBuying","QuantityOfSubstitution","location","customer","provider"],"mappings":"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","file":"admin.controller.js","sourcesContent":["import User from '../models/user.model'\nimport mongoose from 'mongoose';\nimport { body, validationResult } from 'express-validator/check';\nimport ApiError from '../helpers/ApiError'\nimport ApiResponse from '../helpers/ApiResponse'\nimport PriceKm from '../models/price-of-km.model';\nimport Order from '../models/order.model'\n\n//KfQnPp9bNf2S2m6z\nexport default {\n    //create new order \n    async allUsers(req, res, next) {\n        try {\n            if (req.user.type != \"ADMIN\")\n                return next(new ApiError(403, \"not admin user\"));\n\n            let query = {}\n            if (req.query.type) {\n                query.type = req.query.type;\n            }\n            let users = await User.find(query).sort({ creationDate: -1 });\n            return res.status(200).json(users)\n        } catch (err) {\n            next(err)\n        }\n    },\n    //create price for km in diliver\n    async createPriceOfKilloMeter(req, res, next) {\n        try {\n            if (!(req.user.type == \"ADMIN\"))\n                return next(new ApiError(403, \"not admin user\"));\n            if (!req.body.price)\n                return next(new ApiError(422, \"price is required\"))\n            let prices = await PriceKm.find();\n            if (prices.length > 0)\n                return next(new ApiError(400, \"price already exist, update it plz\"))\n            let newDoc = await PriceKm.create(req.body);\n            return res.status(201).json(newDoc);\n        } catch (err) {\n            next(err)\n        }\n    },\n\n    //update price for km in diliver\n    async updatePriceOfKilloMeter(req, res, next) {\n        try {\n            if (!(req.user.type == \"ADMIN\"))\n                return next(new ApiError(403, \"not admin user\"));\n            if (!req.body.price)\n                return next(new ApiError(422, \"price is required\"))\n            let price = await PriceKm.findByIdAndUpdate(\n                req.params.id,\n                req.body,\n                { new: true }\n            )\n            return res.status(200).json(price)\n        } catch (err) {\n            next(err)\n        }\n    },\n\n    //retrive price of KiloMeter \n    async retrivePriceOfOneKm(req, res, next) {\n        try {\n            let pric = await PriceKm.findOne();\n            return res.status(200).json(pric);\n        } catch (err) {\n            next(err)\n        }\n    },\n\n    //deactive user account\n    async deactiveUser(req, res, next) {\n        try {\n            if (!(req.user.type == \"ADMIN\"))\n                return next(new ApiError(403, \"not admin user\"));\n            let userId = req.params.userId;\n            let userDetails = await User.findById(userId);\n            if (!userDetails)\n                return next(new ApiError(404));\n            let newUser = await User.findByIdAndUpdate(userId, { active: false }, { new: true });\n            return res.status(200).json(newUser);\n        } catch (err) {\n            next(err)\n        }\n    },\n    //active user account \n    async activeUser(req, res, next) {\n        try {\n            if (!(req.user.type == \"ADMIN\"))\n                return next(new ApiError(403, \"not admin user\"));\n            let userId = req.params.userId;\n            let userDetails = await User.findById(userId);\n            if (!userDetails)\n                return next(new ApiError(404));\n            let newUser = await User.findByIdAndUpdate(userId, { active: true }, { new: true });\n            return res.status(200).json(newUser);\n        } catch (err) {\n            next(err)\n        }\n    },\n    async adminStatisttics(req, res, next) {\n        let numberOfOrder = await Order.count();\n        let penddingOrder = await Order.count({ status: \"pendding\" });\n        let acceptedOrder = await Order.count({ status: \"accepted\" });\n        let rejectedOrder = await Order.count({ status: \"rejected\" });\n        let onTheWayOrder = await Order.count({ status: \"onTheWay\" });\n        let deliveredOrder = await Order.count({ status: \"delivered\" });\n        let numberOfClient = await User.count({ type: \"NORMAL\" });\n        let numberOfProvider = await User.count({ type: \"PROVIDER\" });\n        return res.status(200).json({\n            numberOfOrder,\n            penddingOrder,\n            acceptedOrder,\n            rejectedOrder,\n            onTheWayOrder,\n            deliveredOrder,\n            numberOfClient,\n            numberOfProvider\n        })\n    },\n\n    async getRecentOrders(req, res, next) {\n        try {\n            let allOrders = await Order.find().sort({ creationDate: -1 }).limit(10)\n                .populate('cartons')\n                .populate('galons')\n                .populate('customer')\n                .populate('provider')\n            //prepare response \n            let result = allOrders.map(elme => {\n                //first prepare cartons\n                let OneOrderItem = {};\n                let cartonsResult = [];\n                let cartons = elme.cartons;\n                let cartonsQuantity = elme.cartonsQuantity;\n                for (let x = 0; x < cartons.length; x++) {\n                    let oneCartonItem = {};\n                    let item = cartons[x];\n                    let quantity = cartonsQuantity[x]\n                    oneCartonItem.item = item;\n                    oneCartonItem.quantity = quantity;\n                    cartonsResult.push(oneCartonItem);\n                }\n                //assign cartons result to order item \n                OneOrderItem.cartons = cartonsResult;\n                //prepare galons    \n                let galonsResult = [];\n                let galons = elme.galons;\n                let galonsQuantityOfBuying = elme.galonsQuantityOfBuying;\n                let galonsQuantityOfSubstitution = elme.galonsQuantityOfSubstitution;\n                for (let x = 0; x < galons.length; x++) {\n                    let oneGalonsItem = {};\n                    let item = galons[x];\n                    let QuantityOfBuying = galonsQuantityOfBuying[x]\n                    let QuantityOfSubstitution = galonsQuantityOfSubstitution[x]\n                    oneGalonsItem.item = item;\n                    oneGalonsItem.galonsQuantityOfBuying = QuantityOfBuying;\n                    oneGalonsItem.galonsQuantityOfSubstitution = QuantityOfSubstitution;\n                    galonsResult.push(oneGalonsItem);\n                }\n                //assign galons result to order item \n                OneOrderItem.galons = galonsResult;\n                OneOrderItem.location = elme.location;\n                OneOrderItem.customer = elme.customer;\n                OneOrderItem.provider = elme.provider;\n                OneOrderItem.status = elme.status;\n                OneOrderItem.creationDate = elme.creationDate;\n                OneOrderItem.id = elme.id;\n                OneOrderItem.price = elme.price;\n                return OneOrderItem;\n            })\n            return res.status(200).json(result)\n\n        } catch (err) {\n            next(err)\n        }\n    },\n\n\n}"]}