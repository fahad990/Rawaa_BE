{"version":3,"sources":["../../src/services/push-notifications.js"],"names":["userId","title","body","findById","user","tokens","pushTokens","payload","notification","icon","length","admin","messaging","sendToDevice","then","console","log","response","catch","error","send","serviceAccount","require","initializeApp","credential","cert","databaseURL"],"mappings":";;;;;;;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;uEAEO,iBAAoBA,MAApB,EAA4BC,KAA5B,EAAmCC,IAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAEc,eAAKC,QAAL,CAAcH,MAAd,CAFd;;AAAA;AAECI,4BAFD;AAGCC,8BAHD,GAGUD,KAAKE,UAHf;AAKGC,+BALH,GAKa;AACZC,0CAAc;AACVP,4CADU,EACHC,UADG;AAEVO,sCAAM;AAFI;AAId;AACA;AACA;AAPY,yBALb;;;AAgBH,4BAAIJ,OAAOK,MAAX,EAAmB;AACfC,kCAAMC,SAAN,GAAkBC,YAAlB,CAA+BR,MAA/B,EAAuCE,OAAvC,EACKO,IADL,CACU,oBAAY;AACdC,wCAAQC,GAAR,CAAY,4BAAZ,EAA0CC,QAA1C;AACH,6BAHL,EAIKC,KAJL,CAIW,iBAAS;AACZH,wCAAQC,GAAR,CAAY,wBAAZ,EAAsCG,KAAtC;AACH,6BANL;AAOH;;AAxBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAeC,I;;;;;AA7BtB;;IAAYT,K;;AACZ;;;;;;;;;;AAEA,IAAMU,iBAAiBC,QAAQ,yBAAR,CAAvB;;AAEAX,MAAMY,aAAN,CAAoB;AAChBC,gBAAYb,MAAMa,UAAN,CAAiBC,IAAjB,CAAsBJ,cAAtB,CADI;AAEhBK,iBAAa;AAFG,CAApB","file":"push-notifications.js","sourcesContent":["import * as admin from 'firebase-admin';\nimport User from \"../models/user.model\";\n\nconst serviceAccount = require(\"../service-account.json\");\n\nadmin.initializeApp({\n    credential: admin.credential.cert(serviceAccount),\n    databaseURL: \"https://rawaaprovider.firebaseio.com\"\n});\n\n//push manual notification\n// admin.messaging().sendToDevice(['fi8EKJAJaaM:APA91bFdooPqy5hZ3cRIsL4S46Jk-Nf6TxrD9DF-Wk_8BXTt-CJSXM1Itgm77aneUvpTZ5mhjBpGG1HhlhLcPkXLn6CpxMB6QdzR4RCj5exe0QoBwkEuWXSM9KkjfDXH5g0WHtwjKCj8'],\n//     {\n//         notification: {\n//             title: \"dsdsd\",\n//             body: \"hello form bakry\",\n//             icon:\"https://image.flaticon.com/icons/png/128/148/148921.png\"\n//         },\n//         data: {\n//             subject: \"bla b\",\n\n//         }\n//     }).then(response => {\n//         console.log(\"Successfully sent message:\", response.results[0]);\n//     })\n//     .catch(error => {\n//         console.log(\"Error sending message:\", error);\n//     });\n\nexport async function send(userId, title, body) {\n\n    let user = await User.findById(userId);\n    let tokens = user.pushTokens;\n\n    const payload = {\n        notification: {\n            title, body,\n            icon: \"https://image.flaticon.com/icons/png/128/148/148921.png\"\n        },\n        // data: {\n        //     subject, subjectId\n        // }\n    }\n\n\n    if (tokens.length) {\n        admin.messaging().sendToDevice(tokens, payload)\n            .then(response => {\n                console.log(\"Successfully sent message:\", response);\n            })\n            .catch(error => {\n                console.log(\"Error sending message:\", error);\n            });\n    }\n\n}"]}