{"version":3,"sources":["../../src/controllers/messageAdmin.controller.js"],"names":["createMessage","req","res","next","targetId","params","userId","user","id","object","text","body","targetUser","create","newMessage","title","status","json","allMessageOfOneUser","find","populate","allDocs"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;;;kBAEe;AACLA,iBADK,yBACSC,GADT,EACcC,GADd,EACmBC,IADnB,EACyB;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAExBC,oCAFwB,GAEbH,IAAII,MAAJ,CAAWC,MAFE;AAGxBA,kCAHwB,GAGfL,IAAIM,IAAJ,CAASC,EAHM;AAKxBC,kCALwB,GAKf;AACTF,sCAAMD,MADG;AAETI,sCAAMT,IAAIU,IAAJ,CAASD,IAFN;AAGTE,4CAAYR;AAHH,6BALe;AAAA;AAAA,mCAUL,uBAAQS,MAAR,CAAeJ,MAAf,CAVK;;AAAA;AAUxBK,sCAVwB;;;AAY5B;AACIC,iCAbwB,GAahB,kBAbgB;AAcxBJ,iCAdwB,GAcjBG,WAAWJ,IAdM;;AAe5B,yDAAKI,WAAWF,UAAhB,EAA4BG,KAA5B,EAAmCJ,KAAnC;;AAf4B,6DAiBrBT,IAAIc,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBH,UAArB,CAjBqB;;AAAA;AAAA;AAAA;;AAmB5BX;;AAnB4B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAqBnC,KAtBU;;AAuBX;AACMe,uBAxBK,+BAwBejB,GAxBf,EAwBoBC,GAxBpB,EAwByBC,IAxBzB,EAwB+B;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAE9BG,kCAF8B,GAErBL,IAAII,MAAJ,CAAWC,MAFU;AAAA;AAAA,mCAGd,uBAAQa,IAAR,CAAa,EAAEP,YAAYN,MAAd,EAAb,EACfc,QADe,CACN,YADM,EAEfA,QAFe,CAEN,MAFM,CAHc;;AAAA;AAG9BC,mCAH8B;AAAA,8DAM3BnB,IAAIc,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBI,OAArB,CAN2B;;AAAA;AAAA;AAAA;;AAQlClB;;AARkC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUzC;AAlCU,C","file":"messageAdmin.controller.js","sourcesContent":["import Message from '../models/message-admin.model'\r\nimport mongoose from 'mongoose';\r\nimport { body, validationResult } from 'express-validator/check';\r\nimport ApiError from '../helpers/ApiError'\r\nimport ApiResponse from '../helpers/ApiResponse'\r\nimport { send } from '../services/push-notifications';\r\n\r\nexport default {\r\n    async createMessage(req, res, next) {\r\n        try {\r\n            let targetId = req.params.userId;\r\n            let userId = req.user.id;\r\n\r\n            let object = {\r\n                user: userId,\r\n                text: req.body.text,\r\n                targetUser: targetId\r\n            }\r\n            let newMessage = await Message.create(object);\r\n\r\n            //send notifications\r\n            let title = \"رسالة من الادارة\";\r\n            let body = newMessage.text;\r\n            send(newMessage.targetUser, title, body)\r\n\r\n            return res.status(201).json(newMessage);\r\n        } catch (err) {\r\n            next(err)\r\n        }\r\n    },\r\n    //retrive all messages\r\n    async allMessageOfOneUser(req, res, next) {\r\n        try {\r\n            let userId = req.params.userId\r\n            let allDocs = await Message.find({ targetUser: userId })\r\n                .populate('targetUser')\r\n                .populate('user')\r\n            return res.status(200).json(allDocs)\r\n        } catch (err) {\r\n            next(err)\r\n        }\r\n    },\r\n}"]}